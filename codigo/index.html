<!DOCTYPE html>
<html lang="en" class="h-100" data-bs-theme="auto">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3">
    <link rel="stylesheet" href="./assets/css/index.css">
    <title>PROKNOW</title>
    <script type="module" src="./assets/js/login.js"></script>
</head>

<body class="text-center h-100 vh-100">

    <div class="cover-container d-flex w-100 h-100 p-3 mx-auto flex-column">
        <header class="mb-3">
            <h3 class="logo">PROKNOW</h3>
            <nav class="nav nav-masthead justify-content-end">
                <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#ModalForm"
                    id="modal-button">Login</button>
            </nav>
        </header>
        <main class="main-content pt-auto">
            <div class="lead-component mt-3 align-items-center justify-content-center">
                <span class="fs-4">
                    <h2>PROKNOW</h2>
                </span>
                <p class="lead" id="parag">A PROKNOW nasceu da necessidade de transformar a vida de pessoas comuns.
                    Por isso, nossa jornada é te auxiliar no trajeto de seus sonhos. Venha conosco e dê um boost na sua
                    vida financeira
                </p>
                <p class="lead"><a class="btn btn-primary btn-lg" id="button">Explorar</a></p>
            </div>

            <!-- Modal Form -->
            <div class="modal fade" id="ModalForm" tabindex="-1" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <!-- Login Form -->
                        <form method="post" id="login-form">
                            <div class="modal-header">
                                <h5 class="modal-title">Login</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                    aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <div class="mb-3">
                                    <label for="Usuario">Usuario<span class="text-danger">*</span></label>
                                    <input type="text" name="usuario" class="form-control" id="username"
                                        placeholder="Insira um usuario">
                                </div>

                                <div class="mb-3">
                                    <label for="Senha">Senha<span class="text-danger">*</span></label>
                                    <input type="Senha" name="senha" class="form-control" id="password"
                                        placeholder="Insira uma senha">
                                </div>
                                <div class="mb-3">
                                    <input class="form-check-input" type="checkbox" value="" id="remember" required>
                                    <label class="form-check-label" for="remember">Lembrar de mim</label>
                                </div>
                            </div>
                            <div class="modal-footer pt-4">
                                <button type="button" class="btn btn-primary mx-auto w-100" id="login-button">Login
                                </button>
                            </div>
                            <p class="text-center">Ainda não tem uma conta, <button class="btn-link" type="button"
                                    data-bs-toggle="modal" data-bs-target="#CadastroForm" id="modal-button"><a href="#"
                                        id="cadastro">Cadastre-se</a></button>
                            </p>
                        </form>



                    </div>
                </div>
            </div>
            <div class="modal fade" id="CadastroForm" tabindex="-1" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <!-- Login Form -->
                        <form method="post" id="cadastro-form">
                            <div class="modal-header">
                                <h5 class="modal-title">Cadastre-se na PROKNOW</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                    aria-label="Close"></button>
                            </div>
                            <div class="modal-body">

                                <div class="etapa etapa1" style="display: none;">
                                    <div class="mb-3">
                                        <label for="Usuario">Usuario<span class="text-danger">*</span></label>
                                        <input type="text" name="usuario" class="form-control" id="newUsername"
                                            placeholder="Insira um usuario">
                                    </div>
                                    <div class="mb-3">
                                        <label for="Nome">Nome completo<span class="text-danger">*</span></label>
                                        <input type="text" name="nome" class="form-control" id="nome"
                                            placeholder="Insira seu nome completo">
                                    </div>
                                    <div class="mb-3">
                                        <label for="Nome">Email<span class="text-danger">*</span></label>
                                        <input type="text" name="email" class="form-control" id="email"
                                            placeholder="Insira seu email">
                                    </div>

                                    <div class="mb-3">
                                        <label for="Senha">Senha<span class="text-danger">*</span></label>
                                        <input type="Senha" name="senha" class="form-control" id="newPassword"
                                            placeholder="Insira uma senha">
                                    </div>
                                    <div class="mb-3">
                                        <label for="Senha">Confirme sua senha<span class="text-danger">*</span></label>
                                        <input type="Senha" name="senha" class="form-control"
                                            id="newPasswordConfirmation" placeholder="Confirme sua senha">
                                    </div>

                                </div>

                                <div class="etapa etapa2">
                                    <div class="mb-3">
                                        <label for="currency" class="form-label">Informe seu salário liquido</label>
                                        <input type="text" class="form-control" id="currency"
                                            oninput="formatarMoeda(this)" placeholder="Insira aqui seu salário!"
                                            value="" required>
                                        <div class="invalid-feedback">
                                            Por favor, insira seu salário!
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label for="bonus" class="form-label">Informe quaisquer bônus
                                            mensal</label>
                                        <input type="text" class="form-control" id="bonus" oninput="formatarMoeda(this)"
                                            placeholder="Insira aqui seus bônus!" value="" required>
                                        <div class="invalid-feedback">
                                            Por favor, insira seus bonus!
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label for="ativos" class="form-label">Você possui algum tipo de
                                            investimento?</label>
                                        <select class="form-select" id="ativos" required>
                                            <option value="">Escolha uma opção</option>
                                            <option>Sim</option>
                                            <option>Não</option>
                                        </select>
                                    </div>
                                    <form class="needs-validation" novalidate>
                                        <div class="row g-3 mb-2 my-3" id="campoAdicional" style="display: none;">
                                            <div class="col-md-10">
                                                <label for="ganhos" class="form-label">Insira os ganhos provenientes
                                                    destes
                                                    investimentos</label>
                                                <input type="text" class="form-control" id="ganhos"
                                                    oninput="formatarMoeda(this)" placeholder="Insira aqui seus ganhos"
                                                    value="" required>
                                                <div class="invalid-feedback">
                                                    Por favor, insira seus ganhos!
                                                </div>
                                            </div>
                                        </div>
                                    </form>

                                </div>
                            </div>

                            <div class="button-login">
                                <button type="button" class="btn btn-primary mb-3 mx-auto w-80"
                                    id="cadastro-button">Cadastrar
                                </button>
                                <button type="button" class="btn btn-primary mb-3 mx-auto w-80"
                                    id="avancar-button">Avancar
                                </button>
                            </div>
                    </div>
                    </form>
                </div>
            </div>
    </div>

    </main>

    <footer class="text-dark-50">
        <p>TIAW - <a
                href="https://github.com/ICEI-PUC-Minas-PMGCC-TI/ti-1-pmg-cc-m-20232-g10-falta-de-educacao-financeira"
                class="text-dark">PROKNOW Alternativas</a></p>
    </footer>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="./assets/js/login.js"></script>
    <script src="./assets/js/cadastro_ganhos.js"></script>
    <script>




    </script>
    <script>

        const cadastroButton = document.getElementById('cadastro-button');
        const avancarButton = document.getElementById('avancar-button');

        async function processaFormLogin(event) {

            event.preventDefault();

            // Captura dos valores dos campos de texto
            let username = document.getElementById("username").value.trim();
            let password = document.getElementById("password").value.trim();

            // Verifica se ambos os campos estão preenchidos
            if (username.length === 0 || password.length === 0) {
                alert('Por favor, preencha ambos os campos de usuário e senha.');
                return;
            }

            let user = await login(username, password);

            if (user) {
                console.log("finalmente caralho", user);
            } else {
                alert('Usuário ou senha incorretos');
            }
        }

        document.addEventListener('DOMContentLoaded', function () {
            let etapaAtual = 1;

            if (etapaAtual < 3) {
                cadastroButton.style.display = 'none';
                avancarButton.style.display = 'block';
            } else {
                cadastroButton.style.display = 'block';
                avancarButton.style.display = 'none';
            }
            console.log(etapaAtual);

            function avancaEtapa() {
                const etapaAtualElement = document.querySelector(`.etapa${etapaAtual}`);
                etapaAtualElement.style.display = 'none';

                etapaAtual++;

                if (etapaAtual > 3 || etapaAtual === 1) {
                    console.log('Enviar dados para o servidor');

                    // Esconde o modal
                    $('#CadastroForm').modal('hide');
                    return;
                }



                const proximaEtapaElement = document.querySelector(`.etapa${etapaAtual}`);
                proximaEtapaElement.style.display = 'block';
            }

            // Adicione um listener para o botão de avançar

            avancarButton.addEventListener('click', avancaEtapa);
        });
        async function postUser() {
            let etapa = 1;

            let username = document.getElementById("newUsername").value.trim();
            let name = document.getElementById("nome").value.trim();
            let email = document.getElementById("email").value.trim();
            let password = document.getElementById("newPassword").value.trim();
            let passwordConfirmation = document.getElementById("newPasswordConfirmation").value.trim();


            if (username.length === 0 || password.length === 0 || passwordConfirmation.length === 0 || nome.length === 0 || email.length === 0) {
                alert('Por favor, preencha todos os campos.');
                return;
            }

            if (password !== passwordConfirmation) {
                alert('As senhas não coincidem.');
                return;
            }

            let user = {
                "login": username,
                "senha": password,
                "nome": name,
                "email": email,
            }

            console.log(user);

            try {
                const response = await fetch(apiPath, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(user)
                });

                const data = await response.json();

                if (data) {
                    alert('Usuário cadastrado com sucesso!');
                    avancaEtapa(etapa);
                }

                $('#CadastroForm').modal('hide');
            } catch (error) {
                console.error('Erro ao cadastrar usuário: ', error);
                alert('Ocorreu um erro ao processar a requisição.');
            }
        }


        document.getElementById("cadastro-button").addEventListener("click", postUser);



        document.getElementById("login-button").addEventListener("click", processaFormLogin);


    </script>
    <script></script>
</body>

</html>